<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace= "com.dabeen.dnd.mapper.UserMapper"> <!-- Mapper 클래스주소-->
    <insert id="insert" parameterType="com.dabeen.dnd.model.entity.User" useGeneratedKeys="false">
        <selectKey order="BEFORE" keyProperty="userNum" resultType="String" > 
            <!-- 쿼리 못해먹겟다. 나중에 고쳐.. -->
            select concat(date_format(now(), "%y%m%d"), LPAD(ifnull(max(substr(user_num, 7)), "0") + 1, 3, 0))
            from user
            where substr(user_num, 1, 6) = date_format(now(), "%y%m%d") 
            <!-- 키 생성 쿼리 -->
        </selectKey>
        insert 
            into user
            values (#{userNum}, #{userName}, #{birthDate}, #{address}, #{phoneNum}, 
                    #{id}, #{pwd}, #{email}, #{nickname}, #{itdcCont}, #{supplWhet}, 
                    #{blonSggName}, #{picPath}, #{rrnRear}, #{avgRate}, #{ownMilege})
    </insert>
</mapper>

<!--
    UserMapper.xml
    식별자를 일련번호롤 생성하기 위한 쿼리문
    
    작성자 : 이은비
-->
